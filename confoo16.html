<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Speeding up the Web with PHP 7</title>

		<meta name="description" content="Speeding up the Web with PHP 7">
		<meta name="author" content="Rasmus Lerdorf">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="/reveal.js/css/reveal.css">
		<link rel="stylesheet" href="/reveal.js/css/theme/white.css" id="theme">

		<!-- For syntax highlighting - note that these are not the generic highlight.js theme files - see https://github.com/nwinkler/reveal-highlight-themes -->
		<link rel="stylesheet" href="/styles/xcode.css">

		<!-- Override a few styles -->
        <style>
        /*
		   Not actually sure why this block isn't being picked up from the syntax highlight css 
		   If you change the syntax highlight theme, copy the first block here
		*/
        .reveal pre code {
                display: block;
                max-height: 600px;
                overflow-x: auto;
                padding: 0.5em;
                line-height: 125%;
                background: #fff;
                color: black;
                -webkit-text-size-adjust: none;
        }

        .reveal section img {
               box-shadow: none;
               border: none;
        }

        .reveal code.shell {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: #000;
            color: #ddd;
            line-height: 125%;
            -webkit-text-size-adjust: none;
        }
        /* Left-align h3 and h4 if they are p elements */
        h3.p {
                text-align: left;
        }
        h4.p {
                text-align: left;
        }
        /* and left-aligned but slightly indented bullet lists */
        .reveal ul {
            display: block;
            margin: 0 0 1em 3em;
        }
		/* Example titles */
		p.example {
			text-align: left;
			margin: 0 0 -0.5em 1em;
			font-weight: bold;
		}
		/* Example output style */
		pre.output {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: #ddd;
            color: black;
			line-height: 200%;
            -webkit-text-size-adjust: none;
		}

        </style>

		 <!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? '/reveal.js/css/print/pdf.css' : '/reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

        <!-- Needed for charts to work. Fall back to network if no local copy -->
        <script type='text/javascript' src='/jquery.min.js'></script> 
        <script>window.jQuery || document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">\x3C/script>')</script>
        <script src="/highcharts.js"></script>
        <script>window.Highcharts || document.write('<script src="http://code.highcharts.com/highcharts.js">\x3C/script>')</script>

		<!--[if lt IE 9]>
		<script src="/reveal.js/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Speeding up the Web with PHP 7</h1>
					<h3>Confoo</h3>
					<h3>Montreal</h3>
					<h3>Feb.24, 2016</h3>
					<a href="http://talks.php.net/confoo16">http://talks.php.net/confoo16</a><br><br>
					<p>Rasmus Lerdorf<br>
					<small><a href="http://twitter.com/@rasmus">@rasmus</a></small>
					</p>
					<aside class="notes">
											</aside>
				</section>
					<section>
		<h2 margin-bottom="2em">1993</h2><br>
		<pre><code class="C" data-trim style="font-size:1.1em;">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;ctype.h&gt;
#include &lt;string.h&gt;

#define ishex(x) (((x) &gt;= '0' &amp;&amp; (x) &lt;= '9') || ((x) &gt;= 'a' &amp;&amp; \
                   (x) &lt;= 'f') || ((x) &gt;= 'A' &amp;&amp; (x) &lt;= 'F'))

int htoi(char *s) {
	int     value;
	char    c;

	c = s[0];
	if(isupper(c)) c = tolower(c);
	value=(c &gt;= '0' &amp;&amp; c &lt;= '9' ? c - '0' : c - 'a' + 10) * 16;

	c = s[1];
	if(isupper(c)) c = tolower(c);
	value += c &gt;= '0' &amp;&amp; c &lt;= '9' ? c - '0' : c - 'a' + 10;

	return(value);
}

void main(int argc, char *argv[]) {
	char *params, *data, *dest, *s, *tmp;
	char *name, *age;

	puts(&quot;Content-type: text/html\r\n&quot;);
	puts(&quot;&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Form Example&lt;/TITLE&gt;&lt;/HEAD&gt;&quot;);
	puts(&quot;&lt;BODY&gt;&lt;H1&gt;My Example Form&lt;/H1&gt;&quot;);
	puts(&quot;&lt;FORM action=\&quot;form.cgi\&quot; method=\&quot;GET\&quot;&gt;&quot;);
	puts(&quot;Name: &lt;INPUT type=\&quot;text\&quot; name=\&quot;name\&quot;&gt;&quot;);
	puts(&quot;Age: &lt;INPUT type=\&quot;text\&quot; name=\&quot;age\&quot;&gt;&quot;);
	puts(&quot;&lt;BR&gt;&lt;INPUT type=\&quot;submit\&quot;&gt;&quot;);
	puts(&quot;&lt;/FORM&gt;&quot;);

	data = getenv(&quot;QUERY_STRING&quot;);
	if(data &amp;&amp; *data) {
		params = data; dest = data;
    	while(*data) {
			if(*data=='+') *dest=' ';
			else if(*data == '%' &amp;&amp; ishex(*(data+1))&amp;&amp;ishex(*(data+2))) {
				*dest = (char) htoi(data + 1);
				data+=2;
			} else *dest = *data;
			data++;
			dest++;
		}
		*dest = '\0';
		s = strtok(params,&quot;&amp;&quot;);
		do {
			tmp = strchr(s,'=');
			if(tmp) {
				*tmp = '\0';
				if(!strcmp(s,&quot;name&quot;)) name = tmp+1;
				else if(!strcmp(s,&quot;age&quot;)) age = tmp+1;
			}
		} while(s=strtok(NULL,&quot;&amp;&quot;));

		printf(&quot;Hi %s, you are %s years old\n&quot;,name,age);
	}
	puts(&quot;&lt;/BODY&gt;&lt;/HTML&gt;&quot;);
}</code></pre>
	</section>
	<section>
		<h2 margin-bottom="2em">1993</h2><br>
<br/>
		<pre><code class="Perl" data-trim>use CGI qw(:standard);
print header;
print start_html('Form Example'),
    h1('My Example Form'),
    start_form,
    &quot;Name: &quot;, textfield('name'),
    p,
    &quot;Age: &quot;, textfield('age'),
    p,
    submit,
    end_form;
if(param()) {
    print &quot;Hi &quot;,em(param('name')),
        &quot;You are &quot;,em(param('age')),
        &quot; years old&quot;;
}
print end_html;</code></pre>
	</section>
	<section>
		<h2 margin-bottom="2em">1994</h2><br>
<br/>
		<pre><code class="PHP" data-trim>&lt;html&gt;&lt;head&gt;&lt;title&gt;Form Example&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;&lt;h1&gt;My Example Form&lt;/h1&gt;
&lt;form action=&quot;form.phtml&quot; method=&quot;POST&quot;&gt;
Name: &lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;
Age: &lt;input type=&quot;text&quot; name=&quot;age&quot;&gt;
&lt;br&gt;&lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
&lt;?if($name):?&gt;
Hi &lt;?echo $name?&gt;, you are &lt;?echo $age?&gt; years old
&lt;?endif?&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
	</section>
	<section>
		<section id="php7">
		<img src="/presentations/slides/intro/php7trans-200.png"  width="" height="">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” engine improvements</p>
		<ul>
			<li style="font-size: 1em;">100%+ performance gain on most real-world applications</li>
			<li style="font-size: 1em;">Lower memory usage, sometimes drastically lower</li>
		</ul>
		</section>
<section id="php7pcache1">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Persistent secondary file-based cache for OPCache</p>
		<img src="/presentations/slides/intro/pcache.png"  width="" height="">
		</section>
<section id="php7pcache3">
		<pre><code class="ini" data-trim style="font-size:1.1em;">; --enable-opcache-file
; php.ini
opcache.file_cache=/var/tmp

; php-cli.ini
opcache.enable_cli=1
opcache.file_cache=/var/tmp
opcache.file_cache_only=1</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;">$ time composer &gt;/dev/null
real	0m0.040s
user	0m0.032s
sys	0m0.004s

$ time composer &gt;/dev/null
real	0m0.019s
user	0m0.016s
sys	0m0.000s

$ time php -d opcache.enable=0 /usr/local/bin/composer &gt;/dev/null
real	0m0.033s
user	0m0.032s
sys	0m0.000s</code></pre>
		</section>
<section id="php7pcache4">
		<pre><code class="shell nohighlight" data-trim style="font-size:0.78em;">/var/tmp
â”œâ”€â”€ 7eeb6fe88104116c27c5650ddd83abf0
â”‚Â Â  â””â”€â”€ usr
â”‚Â Â      â””â”€â”€ local
â”‚Â Â          â””â”€â”€ bin
â”‚Â Â              â””â”€â”€ composer.bin
â””â”€â”€ 7eeb6fe88104116c27c5650ddd83abf0phar:
    â””â”€â”€ usr
        â””â”€â”€ local
            â””â”€â”€ bin
                â””â”€â”€ composer
                    â”œâ”€â”€ bin
                    â”‚Â Â  â””â”€â”€ composer.bin
                    â”œâ”€â”€ src
                    â”‚Â Â  â”œâ”€â”€ bootstrap.php.bin
                    â”‚Â Â  â””â”€â”€ Composer
                    â”‚Â Â      â”œâ”€â”€ Command
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ AboutCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ArchiveCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ClearCacheCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ Command.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ConfigCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ CreateProjectCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ DependsCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ DiagnoseCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ DumpAutoloadCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ GlobalCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ Helper
                    â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ DialogHelper.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ HomeCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ InitCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ InstallCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ LicensesCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ RemoveCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ RequireCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ RunScriptCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ SearchCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ SelfUpdateCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ShowCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ StatusCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ UpdateCommand.php.bin
                    â”‚Â Â      â”‚Â Â  â””â”€â”€ ValidateCommand.php.bin
                    â”‚Â Â      â”œâ”€â”€ Composer.php.bin
                    â”‚Â Â      â”œâ”€â”€ Console
                    â”‚Â Â      â”‚Â Â  â””â”€â”€ Application.php.bin
                    â”‚Â Â      â”œâ”€â”€ Factory.php.bin
                    â”‚Â Â      â”œâ”€â”€ IO
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ BaseIO.php.bin
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ ConsoleIO.php.bin
                    â”‚Â Â      â”‚Â Â  â””â”€â”€ IOInterface.php.bin
                    â”‚Â Â      â”œâ”€â”€ Package
                    â”‚Â Â      â”‚Â Â  â”œâ”€â”€ BasePackage.php.bin
                    â”‚Â Â      â”‚Â Â  â””â”€â”€ PackageInterface.php.bin
                    â”‚Â Â      â”œâ”€â”€ Script
                    â”‚Â Â      â”‚Â Â  â””â”€â”€ ScriptEvents.php.bin
                    â”‚Â Â      â””â”€â”€ Util
                    â”‚Â Â          â””â”€â”€ ErrorHandler.php.bin
                    â””â”€â”€ vendor
                        â”œâ”€â”€ autoload.php.bin
                        â”œâ”€â”€ composer
                        â”‚Â Â  â”œâ”€â”€ autoload_classmap.php.bin
                        â”‚Â Â  â”œâ”€â”€ autoload_namespaces.php.bin
                        â”‚Â Â  â”œâ”€â”€ autoload_psr4.php.bin
                        â”‚Â Â  â”œâ”€â”€ autoload_real.php.bin
                        â”‚Â Â  â””â”€â”€ ClassLoader.php.bin
                        â””â”€â”€ symfony
                            â””â”€â”€ console
                                â””â”€â”€ Symfony
                                    â””â”€â”€ Component
                                        â””â”€â”€ Console
                                            â”œâ”€â”€ Application.php.bin
                                            â”œâ”€â”€ Command
                                            â”‚Â Â  â”œâ”€â”€ Command.php.bin
                                            â”‚Â Â  â”œâ”€â”€ HelpCommand.php.bin
                                            â”‚Â Â  â””â”€â”€ ListCommand.php.bin
                                            â”œâ”€â”€ Descriptor
                                            â”‚Â Â  â”œâ”€â”€ ApplicationDescription.php.bin
                                            â”‚Â Â  â”œâ”€â”€ DescriptorInterface.php.bin
                                            â”‚Â Â  â”œâ”€â”€ Descriptor.php.bin
                                            â”‚Â Â  â”œâ”€â”€ JsonDescriptor.php.bin
                                            â”‚Â Â  â”œâ”€â”€ MarkdownDescriptor.php.bin
                                            â”‚Â Â  â”œâ”€â”€ TextDescriptor.php.bin
                                            â”‚Â Â  â””â”€â”€ XmlDescriptor.php.bin
                                            â”œâ”€â”€ Formatter
                                            â”‚Â Â  â”œâ”€â”€ OutputFormatterInterface.php.bin
                                            â”‚Â Â  â”œâ”€â”€ OutputFormatter.php.bin
                                            â”‚Â Â  â”œâ”€â”€ OutputFormatterStyleInterface.php.bin
                                            â”‚Â Â  â”œâ”€â”€ OutputFormatterStyle.php.bin
                                            â”‚Â Â  â””â”€â”€ OutputFormatterStyleStack.php.bin
                                            â”œâ”€â”€ Helper
                                            â”‚Â Â  â”œâ”€â”€ DebugFormatterHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ DescriptorHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ DialogHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ FormatterHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ HelperInterface.php.bin
                                            â”‚Â Â  â”œâ”€â”€ Helper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ HelperSet.php.bin
                                            â”‚Â Â  â”œâ”€â”€ InputAwareHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ ProcessHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ ProgressHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ QuestionHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ TableHelper.php.bin
                                            â”‚Â Â  â”œâ”€â”€ Table.php.bin
                                            â”‚Â Â  â””â”€â”€ TableStyle.php.bin
                                            â”œâ”€â”€ Input
                                            â”‚Â Â  â”œâ”€â”€ ArgvInput.php.bin
                                            â”‚Â Â  â”œâ”€â”€ ArrayInput.php.bin
                                            â”‚Â Â  â”œâ”€â”€ InputArgument.php.bin
                                            â”‚Â Â  â”œâ”€â”€ InputAwareInterface.php.bin
                                            â”‚Â Â  â”œâ”€â”€ InputDefinition.php.bin
                                            â”‚Â Â  â”œâ”€â”€ InputInterface.php.bin
                                            â”‚Â Â  â”œâ”€â”€ InputOption.php.bin
                                            â”‚Â Â  â””â”€â”€ Input.php.bin
                                            â””â”€â”€ Output
                                                â”œâ”€â”€ ConsoleOutputInterface.php.bin
                                                â”œâ”€â”€ ConsoleOutput.php.bin
                                                â”œâ”€â”€ NullOutput.php.bin
                                                â”œâ”€â”€ OutputInterface.php.bin
                                                â”œâ”€â”€ Output.php.bin
                                                â””â”€â”€ StreamOutput.php.bin

32 directories, 87 files</code></pre>
		</section>
<section id="php7ast">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Abstract Syntax Tree!!</p>
		<pre><code data-trim style="font-size:1.1em;">echo substr(&quot;abc&quot;, [1,2]);</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.8em;">% phan -a test.php
AST_STMT_LIST @ 1
    0: AST_STMT_LIST @ 2
        0: AST_ECHO @ 2
            0: AST_CALL @ 2
                0: AST_NAME @ 2
                    flags: NAME_NOT_FQ (1)
                    0: &quot;substr&quot;
                1: AST_ARG_LIST @ 2
                    0: &quot;abc&quot;
                    1: AST_ARRAY @ 2
                        0: AST_ARRAY_ELEM @ 2
                            flags: 0
                            0: 1
                            1: null
                        1: AST_ARRAY_ELEM @ 2
                            flags: 0
                            0: 2
                            1: null</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.8em;">% phan test.php
test.php:2 TypeError arg#2(start) is int[] but substr() takes int</code></pre>
		</section>
<section id="php7excep">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Exceptions on Fatals</p>
		<pre><code data-trim style="font-size:1.1em;">function call_method($obj) {
    $obj-&gt;method();
}
call_method(null);</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.85em;">Fatal error: Uncaught Error: Call to a member function method() on null in file:2
Stack trace:
#0 file(4): call_method(NULL)
#1 {main}
  thrown in file on line 2</code></pre>
		<pre><code data-trim style="font-size:1.1em;">try {
    call_method(null);
} catch (Error $e) {
    echo &quot;Caught Exception: {$e-&gt;getMessage()}\n&quot;;
}</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.85em;">Caught Exception: Call to a member function method() on null</code></pre>
		</section>
<section id="php7hier">
		<p class="p" style="font-size:2em;text-align:center;">PHP 7 Exception Hierarchy</p>
<br/>
		<ul>
			<li style="font-size: 1.5em;list-style-type: none;"><font color="ab5c5c">Throwable</font></li>
			<li style="font-size: 1.25em;margin-left: 2em;list-style-type: none;">âž¥ <font color="ab5c5c">Exception</font> implements Throwable</li>
			<li style="font-size: 1.25em;margin-left: 2em;list-style-type: none;">âž¥ <font color="ab5c5c">Error</font> implements Throwable</li>
			<li style="font-size: 1em;margin-left: 4em;list-style-type: none;">âž¥ <font color="ab5c5c">TypeError</font> extends Error</li>
			<li style="font-size: 1em;margin-left: 4em;list-style-type: none;">âž¥ <font color="ab5c5c">ParseError</font> extends Error</li>
		</ul>
		</section>
<section id="php7ret">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Return Types</p>
		<pre><code data-trim style="font-size:1.1em;">function get_config(): array {
    return 42;
}
get_config();</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">Fatal error: Uncaught TypeError: Return value of get_config() must be
of the type array, integer returned in file:2
Stack trace:
#0 file(4): get_config()
#1 {main}
  thrown in file on line 2</code></pre>
		</section>
<section id="php7STH">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Coercive Scalar Types</p>
		<pre><code data-trim style="font-size:1.1em;">function logmsg(string $msg, int $level, float $severity) {
    var_dump($msg);      // string(1) &quot;1&quot;
    var_dump($level);    // int(2)
    var_dump($severity); // float(3)
}
logmsg(1, &quot;2.5 bananas&quot;, 3);</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">Notice: A non well formed numeric value encountered in file on line 2</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Strict Scalar Types</p>
		<pre><code data-trim style="font-size:1.1em;">declare(strict_types=1);
...
logmsg(1, &quot;2.5&quot;, 3);</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">Fatal error: Uncaught TypeError: Argument 1 passed to logmsg() must be of the
type string, integer given, called in file on line 7 and defined in file:3
Stack trace:
#0 file(7): logmsg(1, '2.5', 3)
#1 {main}
  thrown in file on line 2</code></pre>
		</section>
<section id="php7anon">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Anonymous Classes</p>
		<pre><code data-trim style="font-size:1.2em;">return new class($controller) implements Page {
    public function __construct($controller) {
        /* ... */
    }
    /* ... */
};

class MyObject extends MyStuff {
    public function getInterface() {
        return new class implements MyInterface {
            /* ... */
        };
    }
}</code></pre>
		</section>
<section id="php7coalesce">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Coalesce Operator</p>
		<pre><code data-trim style="font-size:1.5em;">$a = NULL;
$b = 0;
$c = 2;

echo $a ?? $b; // 0
echo $c ?? $b; // 2
echo $a ?? $b ?? $c; // 0
echo $a ?? $x ?? $c; // 2</code></pre>
		</section>
<section id="Spaceship">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Spaceship Operator</p>
		<pre><code data-trim style="font-size:1.5em;">|=|  Tie Fighter
k=k  Tie Interceptor
&lt;==&gt; Tie Bomber  
&lt;=&gt;  Tie Advanced X1 âœ”</code></pre>
		<pre><code data-trim style="font-size:1.1em;">function cmp_php5($a, $b) {
    return ($a &lt; $b) ? -1 : (($a &gt;$b) ? 1 : 0);
}

function cmp_php7($a, $b) {
    return $a &lt;=&gt; $b;
}</code></pre>
		</section>
<section id="php7assert">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Zero-cost Assertions</p>
		<pre><code data-trim style="font-size:1.1em;">function test($arg) {
    assert($arg &gt; 20 &amp;&amp; $arg &lt; 110, &quot;$arg is invalid&quot;);
}
ini_set('zend.assertions',0); test(16);
ini_set('zend.assertions',1); test(17);
ini_set('assert.exception',1); test(18);</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">Warning: assert(): 17 is invalid failed in file on line 2
Fatal error: Uncaught AssertionError: 18 is invalid in file:2
Stack trace:
#0 file(2): assert(false, '18 is invalid')
#1 file(6): test(18)
#2 {main}
  thrown in file on line 2</code></pre>
		<pre><code class="ini" data-trim style="font-size:1.1em;">; Completely skip compiling assert() calls
; (can only be set in php.ini)
zend.assertions = -1</code></pre>
		</section>
<section id="php7closecall">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Added Closure::call()</p>
		<pre><code data-trim style="font-size:1.1em;">$f = function () {
    return $this-&gt;n;
};
class MyClass {
    private $n = 42;
}
$myC = new MyClass;
$c = $f-&gt;bindTo($myC, &quot;MyClass&quot;);
$c();</code></pre>
		<pre><code data-trim style="font-size:1.1em;">$f = function () {
    return $this-&gt;n;
};
class MyClass {
    private $n = 42;
}
$myC = new MyClass;
$f-&gt;call($myC);</code></pre>
		</section>
<section id="php7cleanups">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Removal of many deprecated features<BR/>
Â Â Â Â Â (Your PHP4 code will break!)</p>
		<pre><code data-trim>- ext/ereg (use ext/pcre instead)
- preg_replace() eval modifier (use preg_replace_callback() instead)
- ext/mysql (use ext/mysqli or ext/pdo_mysql instead)
- Assignment of new by reference
- Scoped calls of non-static methods from incompatible $this context

- dl() in php-fpm
- set_magic_quotes_runtime() and magic_quotes_runtime()
- set_socket_blocking() (use stream_set_blocking() instead)
- mcrypt_generic_end() (use mcrypt_generic_deinit() instead)
- mcrypt_ecb, mcrypt_cbc, mcrypt_cfb and mcrypt_ofb 
  (use mcrypt_encrypt() and mcrypt_decrypt() instead)
- datefmt_set_timezone_id() and IntlDateFormatter::setTimeZoneID() 
  (use datefmt_set_timezone() or IntlDateFormatter::setTimeZone() instead)

- xsl.security_prefs (use XsltProcessor::setSecurityPrefs() instead)
- iconv.input_encoding, iconv.output_encoding, iconv.internal_encoding,
  mbstring.http_input, mbstring.http_output and mbstring.internal_encoding
  (use php.input_encoding, php.internal_encoding and php.output_encoding instead)

- $is_dst parameter of the mktime() and gmmktime() functions
- # style comments in ini files (use ; style comments instead)
- String category names in setlocale() (use LC_* constants instead)
- Unsafe curl file uploads (use CurlFile instead)
- PDO::PGSQL_ATTR_DISABLE_NATIVE_PREPARED_STATEMENT driver option 
  (use PDO::ATTR_EMULATE_PREPARES instead)
- CN_match and SNI_server_name stream context option (use peer_name instead)</code></pre>
		</section>
<section id="php7reserved">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” New reserved words:</p>
		<ul>
			<li style="font-size: 1em;list-style-type: none;">bool</li>
			<li style="font-size: 1em;list-style-type: none;">int</li>
			<li style="font-size: 1em;list-style-type: none;">float</li>
			<li style="font-size: 1em;list-style-type: none;">string</li>
			<li style="font-size: 1em;list-style-type: none;">null</li>
			<li style="font-size: 1em;list-style-type: none;">false</li>
			<li style="font-size: 1em;list-style-type: none;">true</li>
			<li style="font-size: 1em;list-style-type: none;">resource</li>
			<li style="font-size: 1em;list-style-type: none;">object</li>
			<li style="font-size: 1em;list-style-type: none;">mixed</li>
			<li style="font-size: 1em;list-style-type: none;">numeric</li>
		</ul>
		</section>
<section id="php7num">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” 64-bit integer support on Windows</p>
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Cleanup edge-case integer overflow/underflow</p>
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Support for strings with length >= 2^31 bytes in 64 bit builds.</p>
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Parse error on invalid numeric literals</p>
		<pre><code data-trim>$mask = 0855;  // Parse error: Invalid numeric literal</code></pre>
		</section>
<section id="php7UVS">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” Uniform variable syntax</p>
		<pre><code data-trim>// left-to-right
$this-&gt;$belongs_to['column']
// vs.
$this-&gt;{$belongs_to['column']}

// support missing combinations of operations
$foo()['bar']()
[$obj1, $obj2][0]-&gt;prop
getStr(){0}
 
// support nested ::
$foo['bar']::$baz
$foo::$bar::$baz
$foo-&gt;bar()::baz()
 
// support nested ()
foo()()
$foo-&gt;bar()()
Foo::bar()()
$foo()()
 
// support operations on arbitrary (...) expressions
(...)['foo']
(...)-&gt;foo
(...)-&gt;foo()
(...)::$foo
(...)::foo()
(...)()
 
// two more practical examples for the last point
(function() { ... })()
($obj-&gt;closure)()
 
// support all operations on dereferencable scalars
// (not very useful)
&quot;string&quot;-&gt;toLower()
[$obj, 'method']()
'Foo'::$bar</code></pre>
		</section>
<section id="php7unicode">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ”  Unicode Codepoint Escape Syntax</p>
		<pre><code data-trim style="font-size:1.2em;">echo &quot;\u{202E}Right-to-left text&quot;;

echo &quot;\u{1F602}&quot;;</code></pre>
		<pre class="output" style="font-size:1.2em;">â€®Right-to-left textðŸ˜‚		</pre>		<p class="p" style="font-size:1.1em;text-align:left;">âœ” ICU IntlChar class added to intl extension</p>
		</section>
<section id="php7csprng">
		<p class="p" style="font-size:1.1em;text-align:left;">âœ” CSPRNG</p>
		<pre><code data-trim style="font-size:1.2em;">$int   = random_int(-500, 500);
$bytes = random_bytes(10);

var_dump( $int );
var_dump( bin2hex($bytes) );</code></pre>
		<pre class="output" style="font-size:1.2em;">int(-225)
string(20) "d42fc1ba900a6aa2b953"
		</pre>		</section>	</section>
	<section>
		<section id="perf2014">
		<p class="p" style="font-size:0.8em;text-align:left;">Time and number of machine instructions for 100 requests against Wordpress-3.6.0 front page</p>

<div id="perf2014_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/perf2014.js"></script>
		<p class="p" style="font-size:0.5em;">(click on legend items to show/hide data sets)</p>
		</section>	</section>
	<section>
		<section id="php7perfdetail">
		<ul>
			<li style="font-size: 1em;list-style-type: none;">zval size reduced from 24 to 16 bytes</li>
			<li style="font-size: 1em;list-style-type: none;">Hashtable size reduced from 72 to 56 bytes</li>
			<li style="font-size: 1em;list-style-type: none;">Hashtable bucket size reduced from 72 to 32 bytes</li>
			<li style="font-size: 1em;list-style-type: none;">Immutable array optimization</li>
		</ul>
		<pre><code data-trim style="font-size:1.1em;">$a = [];
for($i=0; $i &lt; 100000;$i++) {
    $a[] = ['abc','def','ghi','jkl','mno','pqr'];
}
echo memory_get_usage(true);

// PHP 5.x  109M
// PHP 7.0   42M no opcache
// PHP 7.0    6M with opcache enabled</code></pre>
		</section>
<section id="php7perfdetail2">
		<ul>
			<li style="font-size: 1em;list-style-type: none;">Much more cpu cache friendly</li>
			<li style="font-size: 1em;list-style-type: none;">New memory allocator similar to jemalloc</li>
			<li style="font-size: 1em;list-style-type: none;">Faster hashtable iteration API</li>
			<li style="font-size: 1em;list-style-type: none;">Array duplication optimization</li>
			<li style="font-size: 1em;list-style-type: none;">PCRE JIT enabled by default</li>
			<li style="font-size: 1em;list-style-type: none;">Fast ZPP (ZendParseParameters) implementation</li>
			<li style="font-size: 1em;list-style-type: none;">Faster stack-allocated zvals (instead of heap)</li>
			<li style="font-size: 1em;list-style-type: none;">Optimized VM calling</li>
			<li style="font-size: 1em;list-style-type: none;">Global register variables with gcc 4.8+</li>
			<li style="font-size: 1em;list-style-type: none;">plus hundreds of micro-optimizations</li>
		</ul>
		</section>
<section id="php7perfdetail3">
		<p class="p" style="font-size:1.1em;">HugePage support in Opcache</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.1em;">./configure --enable-huge-code-pages</code></pre>
		<pre><code class="ini" data-trim style="font-size:1.1em;">opcache.memory_consumption=256
opcache.huge_code_pages=1</code></pre>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.1em;">% sysctl -w vm.nr_hugepages=256
% service php-fpm start
% cat /proc/meminfo | grep Huge
HugePages_Total:     256
HugePages_Free:      231
HugePages_Rsvd:      119
HugePages_Surp:        0
Hugepagesize:       2048 kB</code></pre>
		</section>
<section id="php7detail4">
		<h1 style="text-align:center;">JIT?</h1>
		</section>	</section>
	<section>
		<h1 style="text-align:center;">Lies, damn lies and benchmarks</h1>
	</section>
	<section>
		<section id="boxspecs">
		<h2 margin-bottom="2em">Test Box Specs</h2><br>
		<ul>
			<li style="font-size: 0.8em;list-style-type: none;">Gigabyte Z87X-UD3H i7-4771 4 cores @ 3.50GHz w/ 16G of Ram @ 1600MHz</li>
			<li style="font-size: 0.8em;list-style-type: none;">Hyperthreading enabled for a total of 8 virtual cores</li>
			<li style="font-size: 0.8em;list-style-type: none;">Toshiba THNSNHH256GBST SSD</li>
			<li style="font-size: 0.8em;list-style-type: none;">Linux debian 3.16.0-4-amd64 #1 SMP Debian 3.16.7-ckt11-1+deb8u5 (2015-10-09) x86_64 GNU/Linux</li>
			<li style="font-size: 0.8em;list-style-type: none;">MySQL 5.6.27</li>
			<li style="font-size: 0.8em;list-style-type: none;">nginx-1.6.2 + php-fpm for all tests unless indicated otherwise</li>
			<li style="font-size: 0.8em;list-style-type: none;">Quiet local 100Mbps network</li>
			<li style="font-size: 0.8em;list-style-type: none;">siege benchmark tool run from a separate machine</li>
		</ul>
		</section>
<section id="phpconf1">
		<p class="p" style="text-align:left;">All versions of PHP compiled locally using gcc-4.9.2 -O2</p>
<p class="example">configure flags</p>
		<pre><code class="bash" data-trim>./configure --disable-debug       --with-apxs2=/usr/bin/apxs2 \
            --enable-zend-signals --with-gd \
            --without-pear        --with-jpeg-dir=/usr \
            --with-png-dir=/usr   --with-vpx-dir=/usr \
            --with-t1lib=/usr     --with-freetype-dir=/usr \
            --enable-exif         --enable-gd-native-ttf \
            --with-zlib           --with-mysql=/usr \
            --with-gmp            --with-zlib-dir=/usr \
            --with-gettext        --with-kerberos \
            --with-imap-ssl       --with-mcrypt=/usr/local \
            --with-iconv          --enable-sockets \
            --with-openssl        --with-pspell \
            --with-pdo-sqlite     --with-pdo-mysql=mysqlnd \
            --enable-soap         --enable-xmlreader \
            --enable-phar=shared  --with-xsl \
            --enable-ftp          --enable-cgi \
            --with-curl=/usr      --with-tidy \
            --with-xmlrpc         --enable-mbstring \
            --enable-sysvsem      --enable-sysvshm \
            --enable-shmop        --with-readline \
            --enable-pcntl        --enable-fpm \
            --enable-intl         --enable-zip \
            --with-imap           --with-mysqli=mysqlnd \
            --enable-calendar     --prefix=/usr/local \
            --enable-huge-code-pages \
            --with-mysql-sock=/var/run/mysqld/mysqld.sock \
            --with-config-file-scan-dir=/etc/php7/conf.d \
            --with-config-file-path=/etc/php7</code></pre>
		</section>
<section id="phpconf2">
<p class="example">php.ini</p>
		<pre><code class="ini" data-trim>[PHP]
zend.multibyte=On
date.timezone=&quot;America/Los_Angeles&quot;
display_startup_errors=On
zend.enable_gc=Off
include_path=&quot;/usr/local/lib/php&quot;
default_charset=&quot;UTF-8&quot;
error_reporting=-1

variables_order=GPCS
sendmail_path=&quot;&quot;

max_execution_time=60
memory_limit=512M
post_max_size=1024M
cgi.force_redirect=0
cgi.fix_pathinfo=1

magic_quotes=0
magic_quotes_gpc=0
user_ini.filename=
realpath_cache_size=2M
cgi.check_shebang_line=0

max_input_vars=1000
max_file_uploads=50

zend_extension=opcache.so
opcache.enable=1
opcache.memory_consumption=256
opcache.interned_strings_buffer=8
opcache.max_accelerated_files=10000
opcache.revalidate_freq=60
opcache.fast_shutdown=1
opcache.enable_cli=1
opcache.huge_code_pages=1</code></pre>
		</section>
<section id="phpconf3">
<p class="example">php-fpm.d/www.conf</p>
		<pre><code class="ini" data-trim>[www]
user = www-data
group = www-data
listen = /var/run/php-fpm.sock
listen.owner = www-data
listen.group = www-data
listen.mode = 0660

pm = static
pm.max_children = 10
pm.status_path = /status
ping.path = /ping
ping.response = pong</code></pre>
		</section>
<section id="nginxconf1">
<p class="example">nginx.conf</p>
		<pre><code class="nginx" data-trim>user www-data;
worker_processes 4;
pid /var/run/nginx.pid;

events {
        worker_connections 768;
}

http {
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;

        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        access_log /var/log/nginx/access.log;
        error_log /var/log/nginx/error.log;

        gzip on;
        gzip_disable &quot;msie6&quot;;

        include /etc/nginx/conf.d/*.conf;
        include /etc/nginx/sites-enabled/*;
}</code></pre>
		</section>
<section id="nginxconf2">
<p class="example">php.conf</p>
		<pre><code class="nginx" data-trim>location ~ \.php {
  include                  fastcgi_params;
  fastcgi_keep_conn        on;
  fastcgi_index            index.php;
  fastcgi_split_path_info  ^(.+\.php)(/.+)$;
  fastcgi_param PATH_INFO  $fastcgi_path_info;
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  fastcgi_intercept_errors on;
  fastcgi_pass             unix:/var/run/php-fpm.sock;
}</code></pre>
<p class="example">hhvm.conf</p>
		<pre><code data-trim>location ~ \.php$ {
  include           fastcgi_params;
  fastcgi_keep_conn on;
  fastcgi_pass      unix:/var/run/hhvm/server.sock;
  fastcgi_index     index.php;
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
}</code></pre>
		</section>
<section id="nginxconf3">
<p class="example">sites-enabled/wordpress</p>
		<pre><code class="nginx" data-trim>server {
    listen 80;
    server_name wordpress;
    root /var/www/wordpress;
    access_log /var/log/nginx/wordpress-access.log;
    error_log /var/log/nginx/wordpress-error.log;

    location / {
        index     index.html index.htm index.php;
        autoindex on;
    }

    location ~ /\.  { return 403; }

    include backend.conf;
}</code></pre>
		</section>
<section id="hhvmconf1">
		<p class="p" style="font-size:1em;">HipHop VM 3.10.1 (rel) from http://dl.hhvm.com/ubuntu</p>
<p class="example">server.ini</p>
		<pre><code class="ini" data-trim>pid = /var/run/hhvm/pid
hhvm.server.file_socket = /var/run/hhvm/server.sock
hhvm.server.type = fastcgi
hhvm.server.default_document = index.php
hhvm.log.use_log_file = true
hhvm.log.file = /var/log/hhvm/error.log
hhvm.repo.central.path = /var/run/hhvm/hhvm.hhbc</code></pre>
<p class="example">php.ini</p>
		<pre><code class="ini" data-trim>session.save_handler = files
session.save_path = /var/lib/php5
session.gc_maxlifetime = 1440

hhvm.log.level = Warning
hhvm.log.always_log_unhandled_exceptions = true
hhvm.log.runtime_error_reporting_level = 8191
hhvm.mysql.typed_results = false</code></pre>
		</section>	</section>
	<section>
		<section id="drupalbench">

<div id="drupalbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/drupalbench.js"></script>
		</section>	</section>
	<section>
		<section id="wpbench">

<div id="wpbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/wpbench.js"></script>
		</section>
<section id="fdo">
		<p class="p" style="font-size:1.1em;text-align:center;">GCC Feedback-Directed Optimization (FDO)</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1em;">$ make clean
$ make -j8 prof-gen
...
$ sapi/cgi/php-cgi -T 1000 /var/www/wordpress/index.php &gt; /dev/null
$ make prof-clean
$ make -j8 prof-use</code></pre>
		</section>
<section id="wpbench_fdo">

<div id="wpbench_fdo_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/wpbench_fdo.js"></script>
		</section>	</section>
	<section>
		<section id="bbbench">

<div id="bbbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/bbbench.js"></script>
		</section>	</section>
	<section>
		<section id="mwbench">

<div id="mwbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/mwbench.js"></script>
		</section>	</section>
	<section>
		<section id="opencartbench">

<div id="opencartbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/opencartbench.js"></script>
		</section>	</section>
	<section>
		<section id="wardrobebench">

<div id="wardrobebench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/wardrobebench.js"></script>
		</section>	</section>
	<section>
		<section id="geeklogbench">

<div id="geeklogbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/geeklogbench.js"></script>
		</section>	</section>
	<section>
		<section id="magentobench">

<div id="magentobench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/magentobench.js"></script>
		</section>	</section>
	<section>
		<section id="traqbench">

<div id="traqbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/traqbench.js"></script>
		</section>
<section id="traqfix">
		<p class="p" style="font-size:1.1em;text-align:left;">Had to fix one line of code in the Avalon database library:</p>
		<pre><code data-trim style="font-size:1em;">diff --git a/database/model.php b/database/model.php
index 6c5f7da..c93e726 100644
--- a/database/model.php
+++ b/database/model.php
@@ -397,7 +397,7 @@ public function __get($var) {
           $belongs_to['column'] = $var . '_id';
       }
       $model = $belongs_to['model'];
-      return $this-&gt;$var = $model::find($belongs_to['foreign_key'], $this-&gt;$belongs_to['column']);
+      return $this-&gt;$var = $model::find($belongs_to['foreign_key'], $this-&gt;{$belongs_to['column']});
   } else {
       $val = $this-&gt;$var;</code></pre>
		</section>	</section>
	<section>
		<section id="cachetbench">

<div id="cachetbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/cachetbench.js"></script>
		</section>	</section>
	<section>
		<section id="moodlebench">

<div id="moodlebench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/moodlebench.js"></script>
		</section>	</section>
	<section>
		<section id="zencartbench">

<div id="zencartbench_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/nov3/zencartbench.js"></script>
		</section>	</section>
	<section>
		<section id="smem">
		<p class="p" style="font-size:1.3em;text-align:left;">Measuring Memory Use</p>
		<ul>
			<li style="font-size: 0.8em;list-style-type: none;">VSZ - Virtual Memory Size (swapped out, shared libs, everything)</li>
			<li style="font-size: 0.8em;list-style-type: none;">RSS - Resident Set Size (everything not swapped out)</li>
			<li style="font-size: 0.8em;list-style-type: none;">SIZE - Data segment of the process</li>
		</ul>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">debian:/home/rasmus# ps ef -o command,vsize,rss,size -C php-fpm
COMMAND                        VSZ   RSS  SIZE
php-fpm: master process (/u 459152  9912  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304
 \_ php-fpm: pool www       459152  7732  3304</code></pre>
		</section>
<section id="smemtop">
		<p class="p" style="font-size:1.3em;text-align:left;">top isn't helpful either</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">debian:/home/rasmus# top -p $(pgrep -d , php-fpm)
top - 07:04:14 up 19 days, 15:21,  1 user,  load average: 0.00, 0.04, 0.51
Tasks:  11 total,   0 running,  11 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni, 99.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem:  16355868 total, 15789244 used,   566624 free,   493148 buffers
KiB Swap:        0 total,        0 used,        0 free. 13514376 cached Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                    
13950 root      20   0  459152   9912   6016 S   0.0  0.1   0:00.02 php-fpm                                                                    
13951 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13952 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13953 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13954 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13955 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13956 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13957 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13958 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13959 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm                                                                    
13960 www-data  20   0  459152   7732   3836 S   0.0  0.0   0:00.00 php-fpm</code></pre>
		</section>
<section id="smembaseintro">
		<p class="p" style="font-size:1.3em;text-align:left;">smem!</p>
		<ul>
			<li style="font-size: 0.8em;list-style-type: none;">USS - Unique Set Size</li>
			<li style="font-size: 0.8em;list-style-type: none;">PSS - Proportional Set Size</li>
			<li style="font-size: 0.8em;list-style-type: none;">RSS - Resident Set Size</li>
		</ul>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">debian:/home/rasmus# smem -t -k -U www-data -P &quot;.*php-fpm&quot;
  PID User     Command                         Swap      USS      PSS      RSS 
12570 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12571 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12572 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12573 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12574 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12575 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12576 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12577 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12578 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
12579 www-data php-fpm: pool www                  0   156.0K   621.0K     7.6M 
-------------------------------------------------------------------------------
   10 1                                           0     1.5M     6.1M    75.9M</code></pre>
		</section>
<section id="smemload">
		<p class="p" style="font-size:1.3em;text-align:left;">Serving Drupal 8</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.9em;">debian:/home/rasmus# smem -t -k -U www-data -P &quot;.*php-fpm&quot;
  PID User     Command                         Swap      USS      PSS      RSS 
13233 www-data php-fpm: pool www                  0   792.0K     1.3M     9.2M 
13231 www-data php-fpm: pool www                  0   792.0K     1.3M     9.2M 
13235 www-data php-fpm: pool www                  0   792.0K     1.3M     9.2M 
13232 www-data php-fpm: pool www                  0   796.0K     1.3M     9.2M 
13234 www-data php-fpm: pool www                  0   792.0K     1.3M     9.3M 
13227 www-data php-fpm: pool www                  0   808.0K     1.3M     9.2M 
13229 www-data php-fpm: pool www                  0   808.0K     1.3M     9.2M 
13230 www-data php-fpm: pool www                  0   808.0K     1.3M     9.2M 
13226 www-data php-fpm: pool www                  0   808.0K     1.3M     9.2M 
13228 www-data php-fpm: pool www                  0   808.0K     1.3M     9.3M 
-------------------------------------------------------------------------------
   10 1                                           0     7.8M    12.9M    92.4M</code></pre>
		</section>	</section>
	<section>
		<section id="smembase">

<div id="smembase_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smembase.js"></script>
		</section>	</section>
	<section>
		<section id="smemdrupal">

<div id="smemdrupal_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smemdrupal.js"></script>
		</section>	</section>
	<section>
		<section id="smemwp">

<div id="smemwp_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smemwp.js"></script>
		</section>	</section>
	<section>
		<section id="smembb">

<div id="smembb_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smembb.js"></script>
		</section>	</section>
	<section>
		<section id="smemmoodle">

<div id="smemmoodle_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smemmoodle.js"></script>
		</section>	</section>
	<section>
		<section id="smemwardrobe">

<div id="smemwardrobe_container" class="stretch" style="margin: 0 auto"></div>
<script src="presentations/slides/intro/smemwardrobe.js"></script>
		</section>	</section>
	<section>
		<section id="php_contribute">
		<img src="/presentations/slides/intro/rasmus_php7.jpg" align="center" width="" height="">
		</section>
<section id="php_contribute0">
		<h2>Test your applications</h2>
		<h2>Test your extensions</h2>
		</section>
<section id="php_contribute1">
		<h2>It is really easy!</h2>
		</section>
<section id="php_contribute2">
		<p class="p" style="font-size:1.5em;text-align:left;">Full Vagrant Debian Dev Environment</p>
		<p class="p" style="font-size:1.2em;text-align:left;">Or if you prefer Docker:</p>
		<div align="left" style="font-size: 1.2em; color: ; text-align: left; margin-left: ; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/janatzend/docker-php7-nightly-build" target="">github.com/janatzend/docker-php7-nightly-build</a></div>
		</section>
<section id="php_contribute25">
		<p class="p" style="font-size:1.5em;text-align:left;">Install Vagrant and Virtualbox</p>
		<p class="p" style="font-size:1.2em;text-align:left;">Then:</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.2em;">$ git clone https://github.com/rlerdorf/php7dev.git

$ cd php7dev

$ vagrant up
... (takes a bit - it is downloading 1.5G)

$ vagrant ssh</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">It will NAT, DHCP and also has a fixed address of 192.168.7.7</p>
		</section>
<section id="php_contribute3">
		<p class="p" style="font-size:1.1em;text-align:left;">http://192.168.7.7/ will show you the PHP 7 phpinfo() page</p>
		<p class="p" style="font-size:1.1em;text-align:left;">Now you have a working Rasmus-approved dev box on your network</p>
		</section>
<section id="php_contribute4">
		<p class="p" style="font-size:1.1em;text-align:left;">Switching PHP versions is trivial</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.2em;">vagrant@php7dev:~$ newphp 56
Activating PHP 5.6.6-dev and restarting php-fpm

vagrant@php7dev:~$ newphp 7 debug
Activating PHP 7.0.0-dev and restarting php-fpm</code></pre>
		<p class="p" style="font-size:1.1em;text-align:left;">24 pre-compiled versions</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:0.8em;">/usr/local/php53            /usr/local/php55            /usr/local/php70
/usr/local/php53-debug      /usr/local/php55-debug      /usr/local/php70-debug
/usr/local/php53-debug-zts  /usr/local/php55-debug-zts  /usr/local/php70-debug-zts
/usr/local/php53-zts        /usr/local/php55-zts        /usr/local/php70-zts
/usr/local/php54            /usr/local/php56            /usr/local/php71
/usr/local/php54-debug      /usr/local/php56-debug      /usr/local/php71-debug
/usr/local/php54-debug-zts  /usr/local/php56-debug-zts  /usr/local/php71-debug-zts
/usr/local/php54-zts        /usr/local/php56-zts        /usr/local/php71-zts</code></pre>
		</section>
<section id="php_contribute5">
		<p class="p" style="font-size:1.1em;text-align:left;">Build any version</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.2em;">$ makephp 7
Build log in /tmp/build.log
Building PHP 7.0
configuring...
compiling...
installing...
done
Building PHP 7.0-debug
configuring...
compiling...
installing...
done</code></pre>
		</section>
<section id="php_contribute5a">
		<p class="p" style="font-size:1.1em;text-align:left;">or manually</p>
		<pre><code class="shell nohighlight" data-trim style="font-size:1.2em;">$ cd php-src
$ git checkout PHP-5.6
$ git pull -r
$ make distclean
$ ./buildconf -f
$ ./cn56
$ make
$ sudo make install</code></pre>
		</section>	</section>
	<section>
		<section id="thank_you">
		<h2 style="text-align:center;">Thank You</h2>
		<div align="left" style="font-size: 1.2em; color: ; text-align: left; margin-left: 2em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/rlerdorf/php7dev" target="">https://github.com/rlerdorf/php7dev</a></div>
		<div align="left" style="font-size: 1.2em; color: ; text-align: left; margin-left: 2em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://github.com/rlerdorf/phan" target="">https://github.com/rlerdorf/phan</a></div>
		<div align="left" style="font-size: 1.2em; color: ; text-align: left; margin-left: 2em; margin-right: ; margin-top: ; margin-bottom: ;"><a href="https://bugs.php.net" target="">https://bugs.php.net</a></div>
		<div align="left" style="font-size: 1.2em; color: ; text-align: left; margin-left: 2em; margin-right: ; margin-top: ; margin-bottom: ;"><a href=":-:url:-:" target="">http://talks.php.net/confoo16</a></div>
<br/>
<br/>
<br/>
		<p class="p" style="font-size:1.1em;">Report Bugs</p>
		<p class="p" style="font-size:1.1em;">Useful bug reports, please!</p>
		</section>	</section>
			</div>

		</div>

		<script src="/reveal.js/lib/js/head.min.js"></script>
		<script src="/reveal.js/js/reveal.js"></script>

		<script>

			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				width: 1024,
				height: 768,

				transition: 'slide', // none/fade/slide/convex/concave/zoom
				transitionSpeed: 'fast',

				// Optional reveal.js plugins
				dependencies: [
					{ src: '/reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: '/highlight.min.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: '/reveal.js/plugin/zoom-js/zoom.js', async: true },
					{ src: '/reveal.js/plugin/notes/notes.js', async: true }
				]
			});
			/* This draws the graph on the slide on a slidechanged event */
			Reveal.addEventListener('slidechanged', function(event) {
				var callback = "render_"+event.currentSlide.id;
				if(typeof(window[callback])=="function") {
					window[callback]();
				}
			} );
			/* This draws the graph if we got here directly without coming from another slide */
			Reveal.addEventListener('ready', function(event) {
				var callback = "render_"+event.currentSlide.id;
				if(typeof(window[callback])=="function") {
					window[callback]();
				}
			} );
		</script>

	</body>
</html>
